# JVM核心技术

这节课windows需要用到性能工具，super benchmark，预习资料，讲师秦金卫资料JVM里面GClogAnalysize.java

开头讲的东西特别好，潜力就看你额外学了多少东西

研究新技术，比如换了GC，没改代码，效果就这么好，新技术提升了生产力

更开放的心态，接触更多新的技术，有自己的想法，决定了你是否有发展潜力

新技术就像历史前进的车轮，如果你不能乘上这个轮子，你早晚会被它碾碎

所以我们要学习底层的技术，哪怕你现在工作中用不着，这也是把你和相同级别的人区分的一种方式。

复习回顾：内存分区，gc等

堆内存不能跟我们内存一样大，只是Java使用的一小部分

## GC日志解读与分析

Java8默认GC策略并行GC
Java9-15默认的是G1

java -Xmx4g -XX:useParallelGc GcLogAnalsis

GCLogAnalysis.java 模拟GC小工具

结论：堆内存并不是越大越好

有个命令可以把GC的日志打印出来

堆内存太小，会导致OOM
堆内存太大，堆暂停的时间太长

建议：堆内存的使用在不影响系统性能的情况下，尽量的小

Young GC
Full GC(young gc + old gc)
并行GC会导致业务暂停

还可以测试，同一个Xmx，在不同的GC下的情况

在性能测试环境，通过堆内存和GC的组合，来确定最优的配置

脱离场景谈性能都是耍流氓

gceasy.io 把gc日志复制进去，帮助分析

## JVM线程堆栈数据分析

JVM 内部线程主要分为以下几种：
- VM 线程：单例的 VMThread 对象，负责执行 VM 操作，下文将对此进行讨论;
- 定时任务线程：单例的 WatcherThread 对象， 模拟在VM 中执行定时操作的计时器中断；
- GC 线程：垃圾收集器中，用于支持并行和并发垃圾回收的线程;
- 编译器线程： 将字节码编译为本地机器代码;
- 信号分发线程：等待进程指示的信号，并将其分配给Java 级别的信号处理方法。

安全点：
1. 方法代码中被植入的安全点检测入口；
2. 线程处于安全点状态：线程暂停执行，这个时候线程栈不再发生改变；
3. JVM 的安全点状态：所有线程都处于安全点状态。
JVM 支持多种方式来进行线程转储：
1. JDK 工具, 包括: jstack 工具, jcmd 工具, jconsole, jvisualvm, Java Mission Control 等；
2. Shell 命令或者系统控制台, 比如 Linux 的 kill -3，Windows 的 Ctrl + Break 等；
3. JMX 技术， 主要是使用 ThreadMxBean。

fastthread.io

小内存，并行GC和CMS是主流，jdk10+，cms被gc取代了

## 内存分析与相关工具

## JVM问题分析调优经验

讲的太简略了吧

## GC疑难情况问题分析

这个案例挺有意思的

## JVM常见面试问题汇总

一定要自己动手做实验，否则只有一个印象

面试时衡量一个人说的真和假，就看他说的具不具体

形成自己的总结，否则过一两月就忘了

只要找到性能瓶颈，就解决了问题的一半